[gcode_macro M900]
gcode:
  {% if 'K' in params %}
	{% if (params.K|float < 2.0) %}
		{% if 'E' in params %}
			SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
		{% else %}
			SET_PRESSURE_ADVANCE ADVANCE={params.K}
		{% endif %}
		{action_respond_info("K value changed")}
	{% else %}
		{action_respond_info("K value too big")}
		{action_respond_info("K value= %.1f" % (params.K|float))}
	{% endif %}
  {% endif %}